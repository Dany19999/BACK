<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Panel de Empleado - SANTRIX</title>
    <style>
        /* Estilos que definiste */
        body { font-family: sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 90%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        .success { color: #198754; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .btn-green { background-color: #198754; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        .btn-red { background-color: #dc3545; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        .btn-grey { background-color: #6c757d; color: white; padding: 5px 15px; border: none; cursor: pointer; }
        .comunicado-box { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <h1>PANEL EMPLEADOS : SANTRIX</h1>
    
    <p>Bienvenido iniciado sesi칩n como:
        <span th:text="${userNameDisplay}"></span>
    </p>

    <div th:if="${message}" class="success" th:text="${message}"></div>
    <div th:if="${error}" class="error" th:text="${error}"></div>
    
    <hr>

    <h2>游닉 Anuncios y Comunicados Recientes</h2>

    <div th:if="${comunicados.empty}">
        <p>No hay anuncios dirigidos a ti en este momento.</p>
    </div>

    <div th:unless="${comunicados.empty}">
        <div th:each="comunicado : ${comunicados}" class="comunicado-box">
            <h4 th:text="${comunicado.titulo}" style="color: darkblue;">T칤tulo del Anuncio</h4>
            <p>
                <small>Publicado por <strong th:text="${comunicado.autor}"></strong> el 
                <span th:text="${#temporals.format(comunicado.fechaPublicacion, 'dd-MM-yyyy HH:mm')}"></span></small>
            </p>
            <p th:text="${comunicado.contenido}">Contenido del comunicado...</p>
        </div>
    </div>
    <hr>
    
    <h2>Control de Horario</h2>
    
    <form th:action="@{/user/action/entry}" method="post" style="display: inline; margin-right: 10px;">
        <button type="submit" class="btn-green">MARCAR ENTRADA</button>
    </form>

    <form th:action="@{/user/action/exit}" method="post" style="display: inline;">
        <button type="submit" class="btn-red">MARCAR SALIDA</button>
    </form>
    
    <hr>
    
    <h3>Mi Historial de Asistencia</h3>

    <table th:if="${!personalRecords.empty}">
    <thead>
        <tr>
            <th>Entrada</th>
            <th>Salida</th>
            <th>Horas Trabajadas</th> 
            <th>Estado</th> </tr>
    </thead>
    <tbody>
        <tr th:each="record : ${personalRecords}">
            <td th:text="${#temporals.format(record.entryTime, 'dd-MM-yyyy HH:mm')}"></td>
            
            <td th:text="${record.exitTime != null ? #temporals.format(record.exitTime, 'dd-MM-yyyy HH:mm') : '---'}"></td>
            
            <td th:text="${record.exitTime != null ? record.durationHours + 'h' : '---'}"></td> 
            
            <td>
                <span th:if="${record.userName.contains('FALTA AUTOM츼TICA')}" class="error">FALTA</span>
                <span th:if="${record.exitTime == null and !record.userName.contains('FALTA')}" class="success">SESI칍N ACTIVA</span>
                <span th:if="${record.exitTime != null and !record.userName.contains('FALTA')}" style="color: blue;">Completo</span>
            </td>
        </tr>
    </tbody>
</table>

    <p th:if="${personalRecords.empty}" style="color: gray;">A칰n no tienes registros de asistencia en la base de datos.</p>
    
    <p><a th:href="@{/documents/upload}">Subir Documentos y Trabajos</a></p>

    <p>
    <a th:href="@{/user/messages}" style="font-weight: bold; color: rgb(110, 109, 109);">
        M칩dulo de Mensajer칤a
    </a>
</p>

    <br><br>

    <form th:action="@{/logout}" method="post">
        <button type="submit" class="btn-grey">Cerrar Sesi칩n</button>
    </form>
</body>
</html>