<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chat con Empleado #<span th:text="${message.id}"></span></title>
    <style>
        /* Estilos generales para el cuerpo del chat */
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background-color: #f0f2f5; 
        }
        .chat-window {
            width: 100%;
            max-width: 600px; 
            height: 90vh; 
            display: flex;
            flex-direction: column;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden; 
            background-color: #ffffff; 
        }
        .conversation-area {
            flex-grow: 1; 
            background-color: #202c33; 
            padding: 15px;
            overflow-y: auto; 
            display: flex; 
            flex-direction: column;
        }

        /* Estilos de Burbuja */
        .message-bubble {
            max-width: 75%; 
            padding: 8px 12px; 
            margin-bottom: 8px; 
            border-radius: 10px; 
            line-height: 1.4;
            color: #e9edef; 
            position: relative;
        }
        .message-bubble.sent {
            background-color: #005c4b; 
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .message-bubble.received {
            background-color: #2b3b44; 
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .metadata { font-size: 0.7em; color: rgba(255, 255, 255, 0.7); margin-top: 5px; display: block; text-align: right; }
        .message-bubble.received .metadata { text-align: left; }
        .input-bar { padding: 10px 15px; background-color: #f0f2f5; display: flex; align-items: center; border-top: 1px solid #e0e0e0; }
        .input-bar textarea { flex-grow: 1; height: 40px; border-radius: 20px; padding: 10px 15px; border: 1px solid #ccc; margin-right: 10px; resize: none; font-size: 1em; background-color: white; color: #333; }
        .input-bar button { background-color: #008069; color: white; border-radius: 50%; width: 40px; height: 40px; border: none; cursor: pointer; font-size: 1.2em; display: flex; align-items: center; justify-content: center; }
        .chat-header { background-color: #008069; color: white; padding: 15px; text-align: center; font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="chat-window">
        <div class="chat-header">
            Chat con <span th:text="${message.employeeUsername}"></span> (Ticket #<span th:text="${message.id}"></span>)
        </div>

        <div th:if="${message}" class="feedback success" th:text="${message}"></div>
        <div th:if="${error}" class="feedback error" th:text="${error}"></div>
        
        <div class="conversation-area">
            <div class="message-bubble received">
                <p style="margin: 0; font-weight: 500;">
                    <span th:text="${message.employeeMessage}"></span>
                </p>
                <small class="metadata" th:text="'Asunto: ' + ${message.subject} + ' | Enviado por Empleado: ' + ${#temporals.format(message.sentDate, 'HH:mm')}"></small>
            </div>
            
            <div th:if="${message.status == 'RESPONDIDO'}" class="message-bubble sent">
                <p style="margin: 0; font-weight: 500;">
                    <span th:text="${message.adminResponse}"></span>
                </p>
                <small class="metadata" th:text="'Tu respuesta: ' + ${#temporals.format(message.responseDate, 'HH:mm')}"></small>
            </div>
        </div> 
        
        <form th:action="@{/admin/messages/respond/{id}(id=${message.id})}" method="post" class="input-bar">
            
            <input type="hidden" name="subject" th:value="${'Re: ' + message.subject}">
            <textarea id="adminResponse" name="adminResponse" required placeholder="Escribe tu respuesta..." rows="1"></textarea>
            
            <button type="submit">âž¤</button>
        </form>

        <div class="back-link">
            <a th:href="@{/admin/messages}">Volver a la Bandeja de Tickets</a>
        </div>
    </div>
</body>
</html>